<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8" />
  <title>Bootstrap DataTable Example</title>

  <!-- Added required for bootstrap and DataTable -->
  <link rel="stylesheet"
        type="text/css"
        href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.1/css/bootstrap.css" />
  <link rel="stylesheet"
        type="text/css"
        href="https://cdn.datatables.net/1.10.20/css/dataTables.bootstrap4.css" />
  <link rel="stylesheet"
        type="text/css"
        href="https://cdn.datatables.net/autofill/2.3.4/css/autoFill.bootstrap4.min.css" />
  <link rel="stylesheet"
        type="text/css"
        href="https://cdn.datatables.net/buttons/1.6.1/css/buttons.bootstrap4.css" />
  <link rel="stylesheet"
        type="text/css"
        href="https://cdn.datatables.net/colreorder/1.5.2/css/colReorder.bootstrap4.css" />
  <link rel="stylesheet"
        type="text/css"
        href="https://cdn.datatables.net/fixedcolumns/3.3.0/css/fixedColumns.bootstrap4.css" />
  <link rel="stylesheet"
        type="text/css"
        href="https://cdn.datatables.net/fixedheader/3.1.6/css/fixedHeader.bootstrap4.css" />
  <link rel="stylesheet"
        type="text/css"
        href="https://cdn.datatables.net/keytable/2.5.1/css/keyTable.bootstrap4.css" />
  <link rel="stylesheet"
        type="text/css"
        href="https://cdn.datatables.net/responsive/2.2.3/css/responsive.bootstrap4.css" />
  <link rel="stylesheet"
        type="text/css"
        href="https://cdn.datatables.net/rowgroup/1.1.1/css/rowGroup.bootstrap4.css" />
  <link rel="stylesheet"
        type="text/css"
        href="https://cdn.datatables.net/rowreorder/1.2.6/css/rowReorder.bootstrap4.css" />
  <link rel="stylesheet"
        type="text/css"
        href="https://cdn.datatables.net/scroller/2.0.1/css/scroller.bootstrap4.css" />
  <link rel="stylesheet"
        type="text/css"
        href="https://cdn.datatables.net/searchpanes/1.0.1/css/searchPanes.bootstrap4.css" />

  <script type="text/javascript"
          src="https://code.jquery.com/jquery-3.3.1.js"></script>
  <script type="text/javascript"
          src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.1/js/bootstrap.js"></script>
  <script type="text/javascript"
          src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.js"></script>
  <script type="text/javascript"
          src="https://cdn.datatables.net/1.10.20/js/dataTables.bootstrap4.js"></script>
  <script type="text/javascript"
          src="https://cdn.datatables.net/autofill/2.3.4/js/dataTables.autoFill.js"></script>
  <script type="text/javascript"
          src="https://cdn.datatables.net/autofill/2.3.4/js/autoFill.bootstrap4.js"></script>
  <script type="text/javascript"
          src="https://cdn.datatables.net/buttons/1.6.1/js/dataTables.buttons.js"></script>
  <script type="text/javascript"
          src="https://cdn.datatables.net/buttons/1.6.1/js/buttons.bootstrap4.js"></script>
  <script type="text/javascript"
          src="https://cdn.datatables.net/buttons/1.6.1/js/buttons.colVis.js"></script>
  <script type="text/javascript"
          src="https://cdn.datatables.net/colreorder/1.5.2/js/dataTables.colReorder.js"></script>
  <script type="text/javascript"
          src="https://cdn.datatables.net/fixedcolumns/3.3.0/js/dataTables.fixedColumns.js"></script>
  <script type="text/javascript"
          src="https://cdn.datatables.net/fixedheader/3.1.6/js/dataTables.fixedHeader.js"></script>
  <script type="text/javascript"
          src="https://cdn.datatables.net/keytable/2.5.1/js/dataTables.keyTable.js"></script>
  <script type="text/javascript"
          src="https://cdn.datatables.net/responsive/2.2.3/js/dataTables.responsive.js"></script>
  <script type="text/javascript"
          src="https://cdn.datatables.net/rowgroup/1.1.1/js/dataTables.rowGroup.js"></script>
  <script type="text/javascript"
          src="https://cdn.datatables.net/rowreorder/1.2.6/js/dataTables.rowReorder.js"></script>
  <script type="text/javascript"
          src="https://cdn.datatables.net/scroller/2.0.1/js/dataTables.scroller.js"></script>
  <script type="text/javascript"
          src="https://cdn.datatables.net/searchpanes/1.0.1/js/dataTables.searchPanes.js"></script>
  <script type="text/javascript"
          src="https://cdn.datatables.net/searchpanes/1.0.1/js/searchPanes.bootstrap4.js"></script>
</head>

<body>
  <script th:inline="javascript">
    /*<![CDATA[*/
    const example = /*[[${example}]]*/ "default";
      /*]]>*/
  </script>

  <div class="container col-sm-6"
       style="padding-top: 3rem;">
    <h2 style="text-align: center;">Lista Osób</h2>

    <hr />

    <div class="container mb-3 mt-3">
      <table class="table table-striped table-bordered"
             style="width: 100%;"
             id="myDataTable">
        <thead>
          <tr>
            <th scope="col">#</th>
            <th scope="col">Imie</th>
            <th scope="col">Nazwisko</th>
            <th scope="col">E-mail</th>
            <th scope="col">Data urodzenia</th>
            <th scope="col">PESEL</th>
          </tr>
        </thead>
        <tbody>
          <tr th:each="person : ${persons}">
            <th scope="row"
                th:text="${person.id}">1</th>
            <td th:text="${person.name}">Janusz</td>
            <td th:text="${person.surname}">Kłopociński</td>
            <td th:text="${person.email}">janusz.k@nomailcom</td>
            <td th:text="${person.dateOfBirth}">2000-01-01</td>
            <td th:text="${person.personalNumber}">12304982 30</td>
          </tr>
          <tr th:remove="all">
            <th scope="row">2</th>
            <td>Zbigniew</td>
            <td>Gąpka</td>
            <td>zibi.gabka@somedomain.com</td>
            <td>1999-01-01</td>
            <td>0091929 92</td>
          </tr>
          <tr th:remove="all">
            <th scope="row">3</th>
            <td>Piotr</td>
            <td>Kłopotek</td>
            <td>p.trabel@double-trouble.com</td>
            <td>1995-03-01</td>
            <td>1234-pl-10</td>
          </tr>
        </tbody>
        <tfoots>
          <tr>
            <th scope="col">#</th>
            <th scope="col">Imie</th>
            <th scope="col">Nazwisko</th>
            <th scope="col">E-mail</th>
            <th scope="col">Data urodzenia</th>
            <th scope="col">PESEL</th>
          </tr>
        </tfoots>
      </table>
    </div>
  </div>

  <script type="text/javascript">
    $(document).ready(function () {
      switch (example) {
        case 'example1': {
          $("#myDataTable").DataTable({
            language: {
              url: "//cdn.datatables.net/plug-ins/9dcbecd42ad/i18n/Polish.json",
            },
          });
        }
          break;
        case 'example2': {
          $('#myDataTable').DataTable({
            "processing": true,
            "ajax": {
              url: "../persons/api/data",
              dataSrc: function (json) {
                for (var i = 0, ien = json.data.length; i < ien; i++) {
                  json.data[i][0] = '<a href="/message/' + json.data[i][0] + '>View message</a>';
                }
                return json.data;
              },
              dataFilter: function (data) {
                let json = {};
                json.data = jQuery.parseJSON(data);
                json.draw = 1;
                json.recordsTotal = json.data.length;
                json.recordsFiltered = json.data.length;
                result = JSON.stringify(json); // return JSON string
                return result;
              }
            },
            language: {
              url: "//cdn.datatables.net/plug-ins/9dcbecd42ad/i18n/Polish.json",
            },
            columns: [
              { "data": "id" },
              { "data": "name" },
              { "data": "surname" },
              { "data": "email" },
              { "data": "dateOfBirth" },
              { "data": "personalNumber" }
            ]
          });
        }
          break;
        case 'example3': {

          // initialize searh button and key press for example 3
          $(document).on("preInit.dt", function () {
            var $sb = $(".dataTables_filter input[type='search']");
            // remove current handler
            $sb.off();
            // Add key hander
            $sb.on("keypress", function (evtObj) {
                if (evtObj.keyCode == 13) {
                    $('#myDataTable').DataTable().search($sb.val()).draw();
                }
            });
            // add button and button handler
            var btn = $("<button type='button'>Go</button>");
            $sb.after(btn);
            btn.on("click", function (evtObj) {
                $('#myDataTable').DataTable().search($sb.val()).draw();
            });
          });

          $('#myDataTable').DataTable({
            "processing": true,
            "serverSide": true,
            "ajax": {
              url: "../persons/api/data/managed",
              dataSrc: function (json) {
                for (var i = 0, ien = json.data.length; i < ien; i++) {
                  json.data[i][0] = '<a href="/message/' + json.data[i][0] + '>View message</a>';
                }
                return json.data;
              },
              dataFilter: function (data) {
                return data;
              }
            },
            language: {
              url: "//cdn.datatables.net/plug-ins/9dcbecd42ad/i18n/Polish.json",
            },
            columns: [
              { "data": "id", "searchable": true },
              { "data": "name" },
              { "data": "surname" },
              { "data": "email", "searchable": true, "orderable": true },
              { "data": "dateOfBirth", "searchable": true },
              { "data": "personalNumber" }
            ]
          });
        }
          break;
      }
    });
  </script>
</body>

</html>
